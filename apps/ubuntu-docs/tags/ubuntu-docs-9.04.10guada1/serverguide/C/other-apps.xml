<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN" 
	"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
<!ENTITY % globalent SYSTEM "../../libs/global.ent">
%globalent;
<!ENTITY % gnome-menus-C SYSTEM "../../libs/gnome-menus-C.ent">
%gnome-menus-C;
<!ENTITY % xinclude SYSTEM "../../libs/xinclude.mod">
%xinclude;
<!ENTITY language "&EnglishAmerican;">
]>
<chapter id="other-useful-applications" status="review">
  <title>Other Useful Applications</title>

  <para>
  There are many very useful applications developed by the Ubuntu Server Team, 
  and others that are well integrated with Ubuntu Server Edition, that might 
  not be well known.  This chapter will showcase some useful applications that can 
  make administering an Ubuntu server, or many Ubuntu servers, that much easier.
  </para>

  <sect1 id="update-motd" status="review">
    <title>Update MOTD</title>

    <para>
    When logging into an Ubuntu server you may have noticed the informative Message Of The Day (MOTD).  This information
    is obtained and displayed using a couple of packages:
    </para>

    <itemizedlist>
      <listitem>
        <para>
        <emphasis>landscape-common:</emphasis> provides the core libraries of <application>landscape-client</application>,
        which can be used to manage systems using the web based <emphasis>Landscape</emphasis> application.  The package includes
        the <application>/usr/bin/landscape-sysinfo</application> utility which is used to gather the information displayed
        in the MOTD.
        </para>
      </listitem>
      <listitem>
        <para>
        <emphasis>update-motd:</emphasis> is used to automatically update the MOTD via <application>cron</application>.
        </para>
      </listitem>
    </itemizedlist>

    <para>
    The <application>update-motd</application> utility has several options to further customize the MOTD:
    </para>

    <itemizedlist>
      <listitem>
        <para>
        <emphasis>--disable:</emphasis> prevents automatic updates of the MOTD.  Using this option creates the
        <filename>/var/lib/update-motd/disabled</filename> file, which if present stops <application>update-motd</application>
        from modifying <filename>/etc/motd</filename>.
        </para>
      </listitem>
      <listitem>
        <para>
        <emphasis>--enable:</emphasis> enables the automatic MOTD updates.  If <filename>/var/lib/update-motd</filename>
        is present it will be removed.
        </para>
      </listitem>
      <listitem>
        <para>
        <emphasis>--force:</emphasis> does a one time update of <filename>/etc/motd</filename>, overriding <application>update-motd</application>
        if it has been disabled. 
        </para>
      </listitem>
      <listitem>
        <para>
        <emphasis>d, hourly, weekly, monthly:</emphasis> option will run the scripts in <filename>/etc/update-motd.d/</filename> (default), 
        <filename>/etc/update-motd.d/hourly</filename>, <filename>/etc/update-motd.d/weekly</filename>, or
        <filename>/etc/update-motd.d/monthly</filename> respectively.
        </para>
      </listitem>
    </itemizedlist>

    <para>
    <application>update-motd</application> executes the scripts in <filename>/etc/update-motd.d</filename> in order based on the number 
    prepended to the script.  Separate <application>cron</application> scripts execute every ten minutes, hourly, weekly, and monthly
    running the corresponding scripts in <filename>/etc/update-motd.d</filename>.  The output of the scripts is written to 
    <filename>/var/run/update-motd/</filename>, keeping the numerical order, then concatenated with 
    <filename>/etc/motd.tail</filename> and written to <filename>/etc/motd</filename>.
    </para>

    <para>
    You can add your own dynamic information to the MOTD.  For example, to add local weather information:
    </para>

    <itemizedlist>
      <listitem>
        <para>
        First, install the <application>weather-util</application> package:
        </para>

<screen>
<command>sudo apt-get install weather-util</command>
</screen>

      </listitem>
      <listitem>
        <para>
        The <application>weather</application> utility uses METAR data from the National Oceanic and Atmospheric Administration 
        and forecasts from the National Weather  Service. In order to find local information you will need the 4-character ICAO 
        location indicator. This can be determined by browsing to the 
        <ulink url="http://www.weather.gov/tg/siteloc.shtml">National Weather Service</ulink> site.
        </para>

        <para>
        Although the National Weather Service is a United States government agency there are weather stations available world wide.
        However, local weather information for all locations outside the U.S. may not be available.
        </para>
      </listitem>
      <listitem>
        <para>
        Create <filename>/usr/local/bin/local-weather</filename>, a simple shell script to use 
        <application>weather</application> with your local ICAO indicator:
        </para>

<programlisting>
#!/bin/sh
##########################################################################
#
# Prints the local weather to /var/run/update-motd/60-local-weather  
# for update-motd.
#
##########################################################################

# Replace KINT with your local weather station.
# Local stations can be found here: http://www.weather.gov/tg/siteloc.shtml

echo "" > /var/run/update-motd/60-local-weather
weather -i KINT >> /var/run/update-motd/60-local-weather

</programlisting>
      </listitem>
      <listitem>
        <para>
        Make the script executable:
        </para>

<screen>
<command>sudo chmod 755 /usr/local/bin/local-weather</command>
</screen>
      </listitem>
      <listitem>
        <para>
        Next, create a symlink to <filename>/etc/update-motd.d/60-local-weather</filename>:
        </para>

<screen>
<command>sudo ln -s /usr/local/bin/local-weather /etc/update-motd.d/60-local-weather</command>
</screen>
      </listitem>
      <listitem>
        <para>
        Finally, update the MOTD:
        </para>

<screen>
<command>sudo update-motd</command>
</screen>
      </listitem>
    </itemizedlist>

    <para>
    You should now be greeted with some useful information, and some information about the local weather that may not be
    quite so useful. Hopefully the <application>local-weather</application> example demonstrates the flexibility of
    <application>update-motd</application>.
    </para>

  </sect1>
  <sect1 id="other-app-references" status="review">
    <title>References</title>

    <itemizedlist>
      <listitem>
        <para>
        See the <ulink url="http://manpages.ubuntu.com/manpages/jaunty/en/man1/update-motd.1.html">update-motd man page</ulink> for
        more options available to <application>update-motd</application>.
        </para>
      </listitem>
      <listitem>
        <para>
        The Debian Package of the Day 
        <ulink url="http://debaday.debian.net/2007/10/04/weather-check-weather-conditions-and-forecasts-on-the-command-line/">weather</ulink>
        article has more details about using the <application>weather</application>utility.
        </para>
      </listitem>
    </itemizedlist>
  </sect1>
</chapter>
